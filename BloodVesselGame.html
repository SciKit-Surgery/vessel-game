<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Blood Vessel Generation Demo</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.16.2/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

	var config = {
		type: Phaser.AUTO,
		width: 612,
		height: 612,
		physics: {
			default: 'arcade',
			arcade: {
				debug: true,
				gravity:
				{
					y:0
				}
			}
		},
		scene: {
			preload: preload,
			create: create,
			update: update
		}
	};
	
	var game = new Phaser.Game(config);

	function preload()
	{
		defaultScene = this;
		
		//loading permanent graphics assets
		this.load.image('blood', 'assets/images/blood.jpg');
		
		//loading global variables
		this.load.script('s_globals','assets/scripts/Globals.js');
		//loading classes
		this.load.script('s_LevelParams','assets/scripts/LevelParams.js');
		this.load.script('s_Point','assets/scripts/Point.js');
		this.load.script('s_VesselCoordinates','assets/scripts/VesselCoordinates.js');
		this.load.script('s_BloodVessel','assets/scripts/BloodVessel.js');
		this.load.script('s_PointGenerator','assets/scripts/PointGenerator.js');
		this.load.script('s_VesselGenerator','assets/scripts/VesselGenerator.js');
		this.load.script('s_Camera','assets/scripts/Camera.js');
		this.load.script('s_LevelTimer','assets/scripts/LevelTimer.js');
		this.load.script('s_CutCursor','assets/scripts/CuttingHead.js');
		this.load.script('s_KeyManager','assets/scripts/KeyManager.js');
		this.load.script('s_LevelRecord','assets/scripts/levelRecord.js');
		this.load.script('s_Level','assets/scripts/level.js');

	}

	function create ()
	{
		//CURRENT ISSUE: NEW LEVELS GENERATE AS INTENDED, BUT AFTER FIRST LEVEL THE ABILITY TO CUT ACCURATELY HAS BEEN LOST
		//FIGURE OUT HWY AND SORT IT OUT 16 01 24
			

		//PERMANENT GRAPHICS
		//Shouldn't be deleted when the scene is cleared.
		this.add.image(w/2, h/2, 'blood');
		
		//VESSEL GRAPHICS - displays blood vessels only
		let vesselGraphics = this.add.graphics(w/2,h/2);	

				
		//CUTTING LINE GRAPHICS - displays cutting lines only
		let lineGraphics = this.add.graphics(w/2,h/2)
		lineGraphics.lineStyle(5, '0x00c9ff', 1.0);
		lineGraphics.fillStyle('0x00c9ff', 1.0);
		
		//KEYBOARD 
		keyManager = new KeyManager(this);
		
		//TESTING BLOCK
		//For now, this section is used to test generation.
		
		var testParams = new levelParams((Phaser.Math.Between(1,5)),(Phaser.Math.Between(1,10))/10);
		
		//testParams.SetParams(Phaser.Math.Between(1,5));
		//testParams.camSize = (Phaser.Math.Between(1,10))/10;
		
		//CAMERA AND MASK TESTING
		
		cameraRadius = (w/2) * testParams.camSize;
		
		mainCamera = new Camera(this,cameraRadius,false); 							//camera
		
		cameraMask = new Phaser.Display.Masks.BitmapMask(this, mainCamera.circle)	//mask
		cameraMask.invertAlpha = true;
		
		screenBlocker = this.add.rectangle(w/2, h/2, w, h, 0x000000);
		screenBlocker.setDepth(1000); //keeps rectangle in front of everything
		screenBlocker.setMask(cameraMask);
			
	
		//LEVEL GENERATION 
		
		timer = new levelTimer(this,clockTick) //new clock which updates every 500 ms
			
		level = new level(this,vesselGraphics, timer, mainCamera);
		level.generate(testParams);	//all the creation stuff should be in here
	
		//CURSOR
		
		cutCursor = new cutHead(this,level.bloodVessels,lineGraphics,keyManager,5,5,w,h); //places cursor at your mouse position to begin the game
		
		

		
		//TEMPORARY TEXT (TURN INTO BETTER UI LATER)
		
		//this.add.text(w/2, h/2, "Difficulty: " + testParams.difficulty, { fontFamily: 'Georgia, "Goudy Bookletter 1911", Times, serif' });
		//this.add.text(w/2, h/3, "Camera Size: " + testParams.camSize, { fontFamily: 'Georgia, "Goudy Bookletter 1911", Times, serif' });
		timerText = this.add.text(w/2, h/4, "Time Elapsed: " + timer.GetLevelTime(), { fontFamily: 'Georgia, "Goudy Bookletter 1911", Times, serif' });
		mistakeText = this.add.text(w/2, h/5, "Mistakes: " + level.levelRecord.mistakenCuts, { fontFamily: 'Georgia, "Goudy Bookletter 1911", Times, serif' });
		
	}

	function update()
	{
		if (level.levelRecord.completed == true)
		{
			var testParams = new levelParams((Phaser.Math.Between(1,5)),(Phaser.Math.Between(1,10))/10);
			level.generate(testParams);
			cutCursor.vessels = level.bloodVessels;

		}
		

		mainCamera.UpdatePosition();
		cutCursor.ListenForKeys();
		cutCursor.ListenForMouse();
		timerText.setText("Time Elapsed: " + timer.GetLevelTime());
		mistakeText.setText("Mistakes: " + level.levelRecord.mistakenCuts);
		
	}

</script>

</body>
</html>
